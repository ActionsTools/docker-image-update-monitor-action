name: "test"
on:
  workflow_dispatch:
  schedule:
    # Every hour
    - cron: '0 */1 * * *'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        path: "./"

    - name: Cache file
      uses: actions/cache@v3
      with:
        # TODO: Still bug here, no such file
        key: sharelatex#sharelatex_latest-${{ github.run_attempt }}
        restore-keys: |
          sharelatex#sharelatex_latest-
        path: sharelatex#sharelatex_latest.json

    - name: Check DockerHub image with latest tag
      id: dockerhub_latest
      uses: ./
      with: 
        image: 'sharelatex/sharelatex'
        tag: 'latest'

    - name: Show results
      run: |
        echo ${{ steps.dockerhub_latest.outputs.has_update }}
        echo ${{ steps.dockerhub_latest.outputs.update_time }}